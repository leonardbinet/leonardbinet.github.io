

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>api_etl.extract_schedule module &mdash; api_transilien_doc  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="api_transilien_doc  documentation" href="index.html"/>
        <link rel="next" title="api_etl.query_schedule module" href="api_etl.query_schedule.html"/>
        <link rel="prev" title="api_etl.extract_api module" href="api_etl.extract_api.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> api_transilien_doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Main modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api_etl.extract_api.html">api_etl.extract_api module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">api_etl.extract_schedule module</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_etl.query_schedule.html">api_etl.query_schedule module</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_etl.utils_dynamo.html">api_etl.utils_dynamo module</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_etl.utils_api_client.html">api_etl.utils_api_client module</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_etl.utils_misc.html">api_etl.utils_misc module</a></li>
</ul>
<p class="caption"><span class="caption-text">All modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_etl.html">api_etl package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">api_transilien_doc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>api_etl.extract_schedule module</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/api_etl.extract_schedule.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-api_etl.extract_schedule">
<span id="api-etl-extract-schedule-module"></span><h1>api_etl.extract_schedule module<a class="headerlink" href="#module-api_etl.extract_schedule" title="Permalink to this headline">¶</a></h1>
<p>Module used to download from SNCF website trains schedules and save it in the right format in different databases (Dynamo or relational database)</p>
<dl class="function">
<dt id="api_etl.extract_schedule.build_stop_times_ext_df">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">build_stop_times_ext_df</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.build_stop_times_ext_df" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRECATED</p>
<p>Build stop times extended dataframe out of:
- trips
- calendar
- stop_times
- stops
Adds column:
- train_num out of trip_id
- station_id out of stop_id
Clean:
- remove NaN values</p>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.build_trips_ext_df">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">build_trips_ext_df</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.build_trips_ext_df" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRECATED</p>
<p>Build trips extended dataframe out of:
- trips
- calendar
Adds column:
- train_num out of trip_id
Clean:
- remove NaN values</p>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.download_gtfs_files">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">download_gtfs_files</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.download_gtfs_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Download gtfs files from SNCF website (based on URL defined in settings module) and saves it in data folder (defined as well in settings module). There is no paramater to pass.</p>
<p>Process is in two steps:
- first: download csv file containing links to zip files
- second: download files based on urls found in csv from first step</p>
<p>Folder names in which files are unzip are based on the headers of the zip files.</p>
<p>Function returns True if &#8216;gtfs-lines-last&#8217; folder has been found (this is the usual folder we use then to find schedules). Return False otherwise.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.dynamo_save_stop_times_of_day">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">dynamo_save_stop_times_of_day</code><span class="sig-paren">(</span><em>yyyymmdd_format</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.dynamo_save_stop_times_of_day" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a date, this function will save all trip-ids scheduled on transilien&#8217;s network on this day in Dynamo&#8217;s &#8216;scheduled_departures&#8217; table.</p>
<p>This function requires that gtfs files are present in data folder specified in settings module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>yyyymmdd_format</strong> (<em>string or int</em>) &#8211; date on yyyymmdd format</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.dynamo_save_stop_times_of_day_adapt_provision">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">dynamo_save_stop_times_of_day_adapt_provision</code><span class="sig-paren">(</span><em>yyyymmdd_format</em>, <em>ignore_fail=True</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.dynamo_save_stop_times_of_day_adapt_provision" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a date, this function will first update Dynamo&#8217;s &#8220;scheduled_departures&#8221; table provisioned throughput to be able to save data in less than 30 minutes.</p>
<p>Then it will save all trip-ids scheduled on transilien&#8217;s network on this day in Dynamo&#8217;s table.</p>
<p>Finally it update table provisioned throughput to a lower value on write operations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>yyyymmdd_format</strong> (<em>string or int</em>) &#8211; date on yyyymmdd format</li>
<li><strong>ignore_fail</strong> (<em>boolean</em>) &#8211; default True. If you try to update provisioned throughput to existing values, it will raise an error. It is not a problem, so you might want to ignore this error.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.get_departure_times_of_day_json_list">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">get_departure_times_of_day_json_list</code><span class="sig-paren">(</span><em>yyyymmdd_format</em>, <em>stop_filter=None</em>, <em>station_filter=None</em>, <em>df_format=False</em>, <em>dropna_index=True</em>, <em>drop_dup=True</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.get_departure_times_of_day_json_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a date, this function will return all trip-ids scheduled on transilien&#8217;s network on this day.</p>
<p>This function requires that gtfs files are present in data folder specified in settings module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>yyyymmdd_format</strong> (<em>string or int</em>) &#8211; date on yyyymmdd format</li>
<li><strong>stop_filter</strong> (<em>None/False or list of valid stops_ids</em>) &#8211; default None. If set, should be a list of stops for which you want to obtain stop times scheduled on this day. Otherwise, if set to False or None, it will get all stops without restrictions on stations.</li>
<li><strong>station_filter</strong> (<em>None/False or list of valid station_filter</em>) &#8211; default None. If set, should be a list of station ids for which you want to obtain stop times scheduled on this day. Otherwise, if set to False or None, it will get all stops without restrictions on stations.</li>
<li><strong>df_format</strong> (<em>boolean</em>) &#8211; default False. If set to True, will return a pandas dataframe</li>
<li><strong>dropna_index</strong> (<em>boolean</em>) &#8211; default True. If True, it will drop all rows where the index fields (&#8220;station_id&#8221;, &#8220;day_train_num&#8221;) might have NaN values. Do not set to False in production since the items with no such fields will raise errors when trying to save on tables with primary keys on these fields. The purpose of this function is to facilitate schedule investigation.</li>
<li><strong>drop_dup</strong> (<em>boolean</em>) &#8211; default True. If True, it will drop all duplicates based on index fields (&#8220;station_id&#8221;, &#8220;day_train_num&#8221;). There should not be duplicates given the GTFS structure. This parameter is just here for investigation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list of json serializable objects, or pandas dataframe if df_format is set to True</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.get_services_of_day">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">get_services_of_day</code><span class="sig-paren">(</span><em>yyyymmdd_format</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.get_services_of_day" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a date, this function will return all service-ids scheduled on transilien&#8217;s network on this day.</p>
<p>This function requires that gtfs files are present in data folder specified in settings module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>yyyymmdd_format</strong> (<em>string or int</em>) &#8211; date on yyyymmdd format</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.get_trips_of_day">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">get_trips_of_day</code><span class="sig-paren">(</span><em>yyyymmdd_format</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.get_trips_of_day" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a date, this function will return all trip-ids scheduled on transilien&#8217;s network on this day.</p>
<p>This function requires that gtfs files are present in data folder specified in settings module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>yyyymmdd_format</strong> (<em>string or int</em>) &#8211; date on yyyymmdd format</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.save_all_schedule_tables_rdb">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">save_all_schedule_tables_rdb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.save_all_schedule_tables_rdb" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRECATED</p>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.save_stop_times_extended_rdb">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">save_stop_times_extended_rdb</code><span class="sig-paren">(</span><em>dryrun=False</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.save_stop_times_extended_rdb" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRECATED</p>
<p>Save stop_times_ext table</p>
</dd></dl>

<dl class="function">
<dt id="api_etl.extract_schedule.save_trips_extended_rdb">
<code class="descclassname">api_etl.extract_schedule.</code><code class="descname">save_trips_extended_rdb</code><span class="sig-paren">(</span><em>dryrun=False</em><span class="sig-paren">)</span><a class="headerlink" href="#api_etl.extract_schedule.save_trips_extended_rdb" title="Permalink to this definition">¶</a></dt>
<dd><p>DEPRECATED</p>
<p>Save trips_ext table</p>
</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api_etl.query_schedule.html" class="btn btn-neutral float-right" title="api_etl.query_schedule module" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api_etl.extract_api.html" class="btn btn-neutral" title="api_etl.extract_api module" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Leonard Binet.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>